<div id="radiator" class="container waylon">
    <!-- If you're looking at the source of this page and wondering why
         this div is empty, here's why: #radiator is a place-holder div
         for jQuery, which dynamically writes HTML here from "./data".
         The #loading div below is shown and hidden based on a conditional
         at the bottom of this page.
    -->
    <div id="loading">
        <span class="glyphicon glyphicon-refresh loadingIndicator"></span>
        <p>Getting the latest data, just for you.</p>
    </div>
</div>

<script src="/js/jquery-1.11.0.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script>
    function refreshRadiator() {
        $(function() {
            $('#radiator').load('/view/<%= escape(@this_view) %>/data');
        });
    }
    $(document).ajaxSend(function() {
        $('#loading').show();
    });
    $(document).ajaxComplete(function () {
        $('#loading').hide();
        $('[data-toggle="tooltip"]').tooltip({'placement': 'bottom'});

        // Nirvana mode
        if(($('.building-job').length == 0) && ($('.failed-job').length == 0) && $('.alert-danger').length == 0) {
            $('body').addClass('nirvana');
            $('body').css('background-image', 'url(<%= @nirvana_img %>)');
            $('#radiator').hide();
        }
        else {
            $('body').removeClass('nirvana');
            $('body').css('background-image', 'none');
            $('#radiator').show();
        }
    });

    $(document).ready(refreshRadiator)
    setInterval(refreshRadiator, <%= @refresh_interval * 1000 %>);

</script>
